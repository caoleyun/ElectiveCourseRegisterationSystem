<!DOCTYPE html>
<html class='no-js' lang='en'>
<head>
  <meta charset='utf-8'>
  <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
  <title>管理员面板 - XXXX选修课报名系统</title>
  <link href="/css/application-a07755f5.css" rel="stylesheet" type="text/css" />
  <link href="/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
  <link href="/css/iconfont.css" rel="stylesheet" type="text/css"></head>
  <link rel="stylesheet" href="/css/ui.jqgrid.css">
  <link rel="stylesheet" href="/css/jquery-ui-1.8.16.custom.css">
  
  <style type="text/css">
    
  </style>

<body class='main page'>
  <!-- Navbar -->
  <%- include("include/header.ejs",{}) %>

  <div id='wrapper'>
    <%- include("include/sidebar.ejs",{}) %>

    <!-- Tools -->
    <section id='tools'>
      <ul class='breadcrumb' id='breadcrumb'>
        <li class='active'>
          学生清单
        </li>
        <li>
          <a href="/admin/student/import">导入学生</a>
        </li>
      </ul>
    </section>
    <!-- Content -->
    <div id='content'>
      <div class='panel panel-default'>
        <div class='panel-heading'>
          全部学生清单
        </div>
        <div class='panel-body'>
            <!-- 放置表格的地方 -->
            <table id="list"></table>
            <div id="listnav"></div>
            <input type="button" value="删除" id="delbtn"/>
        </div>
      </div>
    </div>
  </div>
  
  <script type="text/javascript" src="/js/jquery.min.js"></script>
  <script type="text/javascript" src="/js/grid.locale-cn.js"></script>
  <script type="text/javascript" src="/js/bootstrap.js"></script>
  <script type="text/javascript" src="/js/jquery.jqGrid.src.js"></script>
  <script type="text/javascript">
    //初始化表格
    $("#list").jqGrid({
        //使用的数据是本地数据，实际上也是Ajax请求回来的
        datatype: "json",
        url : "/student",
        //列明
        colNames:["学号","姓名","年级","初始密码"],
        //列的模型
        colModel:[
            {name:'sid'   , index:'sid'    , width:50 , key : true , editable : true},
            //editable表示可以被编辑
            {name:'name'  , index:'name'   , width:50 , editable : true},
            //年级的那个列，编辑的时候显示下拉列表框
            {
                name:'grade'   ,
                index:'grade'  , 
                width:50      , 
                editable : true,
                edittype : "select",
                editoptions : {
                  value : "初一:初一;初二:初二;初三:初三;高一:高一;高二:高二;高三:高三"
                }
            } ,
            {name:'password'  , index:'password'   , width:50 , editable : true},
        ],
        rowNum:10,
        rowList:[10,20,30],
        sortname: 'sid',
        viewrecords: true,
        autowidth:true,
        pager : '#listnav',
        cellEdit : true,    
        cellsubmit : "clientArray",
        height:300,
        afterSaveCell : function(rowid, cellname, value, iRow, iCol){
            //因为设置colModel将sid这列加上了key:true。rowid就是主键，rowid小格格里面填写的内容就是主键。
                //发出请求
                $.post("/student/" + rowid , {
                    "cellname" : cellname,
                    "value" : value
                },function(data){
                    if(data.result == 1){
                        new Tip("更改成功");
                        // alert("更改成功");

                    }else if(data.result == -1){
                        new Tip("你试图更改" + rowid + "，而数据库中没有这个条目。很有可能是其他老师在同时操作，请刷新页面！");
                        // alert("你试图更改" + rowid + "，而数据库中没有这个条目。很有可能是其他老师在同时操作，请刷新页面！");
                    }else if(data.result == -2){
                        new Tip("服务器错误，请联系管理员，错误代码-2。");
                        // alert("服务器错误，请联系管理员，错误代码-2。");
                    }
                });
        }
    });


  </script>

 <!-- //封装一个 修改成功的 小提示 -->
  <script type="text/javascript">

    //封装一个 修改成功的 小提示 
    function Tip(title){
      this.title=title;
      this.init();
    }

    Tip.prototype.init=function(){
      //创建DOM 添加属性
      // this.dom=$("<div class='info_tip'></div>");
      //追加DOM元素
      $("body").append("<div class='info_tip'>"+this.title+"</div>");
      $(".info_tip").css({
          "width": "198px",
          "height": "50px",
          "position": "relative",
          "left": "50%",
          "top": "10px",
          "background-color": "#00eaff3b",
          "transform": "translate(-50%)",
          "text-align":"center",
          "line-height":"50px",
          "color":"#b60cf9"
        });
      this.fly();//向上飞
    }

    Tip.prototype.fly=function(){
      let self=this;
      $(".info_tip").animate({
        'top':"-40px",
        '-moz-opacity':0,
        '-khtml-opacity':0,
        'opacity':0
      },1000,function(){
        self.none();
      });
    }

    Tip.prototype.none=function(){
      $(".info_tip").remove();
    }

   


  </script>

</body>
</html>